<mat-card class="rental-card">
  <mat-card-header>
    <mat-card-title>
        <mat-form-field *ngIf="rentalData.editAddress">
          <input matInput placeholder="Street" name="street" [(ngModel)]="rentalData.streetAddress">
        </mat-form-field>
        <span *ngIf="!rentalData.editAddress"><h2 style="display:inline-block;">{{rentalData.streetAddress}}</h2></span>
        <mat-slide-toggle class="edit-toggle" [(ngModel)]="rentalData.editAddress">Edit Address</mat-slide-toggle>
    </mat-card-title>
    <mat-card-subtitle *ngIf="rentalData.editAddress">
        <mat-form-field  class="mid-input">
          <input matInput placeholder="City" name="city" [(ngModel)]="rentalData.cityAddress">
        </mat-form-field>,&nbsp;
        <mat-form-field class="short-input">
          <mat-select [(value)]="rentalData.stateAddress" placeholder="State">
              <mat-option *ngFor="let state of stateList" [value]="state">
                {{state}}
              </mat-option>
          </mat-select>
        </mat-form-field>,&nbsp;
        <mat-form-field class="short-input">
          <input matInput placeholder="Zip Code" name="zip" [(ngModel)]="rentalData.zipAddress">
        </mat-form-field>
    </mat-card-subtitle>
    <mat-card-subtitle *ngIf="!rentalData.editAddress">
        <span><h3>{{rentalData.cityAddress}},&nbsp;{{rentalData.stateAddress}},&nbsp;{{rentalData.zipAddress}}</h3></span>
    </mat-card-subtitle>
  </mat-card-header>
  <mat-card-content>
    <span class="outflow" [class.positive]="rentalData.rent>monthlyOutflow" matTooltip="monthly cashflow">
      <p>outflow</p><h4>{{monthlyOutflow | currency}}</h4>
    </span>
    <span class="income" [class.positive]="monthlyIncome>0" matTooltip="resulting monthly income">
      <p>income</p><h4>{{monthlyIncome | currency}}</h4>
    </span>
    <span class="yield" [class.positive]="yield>0" matTooltip="Cap Rate: {{(monthlyIncome*12) / (rentalData.price*(1+feesPercentage)) | percent:'1.2-2'}}">
      <p>yield</p><h4>{{yield | percent:'1.2-2'}}</h4>
    </span>
    <mat-tab-group>
        <mat-tab label="Market">
              <p>
                <mat-form-field class="card-input">
                  <span matPrefix>$ &nbsp;</span>
                  <input matInput placeholder="Price" name="price" [(ngModel)]="rentalData.price" (blur)="updatePerformance();">
                </mat-form-field>
                <mat-form-field class="card-input">
                  <span matPrefix>$ &nbsp;</span>
                  <input matInput placeholder="Rent Estimate" name="rent" [(ngModel)]="rentalData.rent" (blur)="updatePerformance();">
                </mat-form-field>
              </p>
              <p>
                <mat-form-field class="card-input">
                  <span matPrefix>$ &nbsp;</span>
                  <input matInput placeholder="HOA" name="hoa" [(ngModel)]="rentalData.hoa" (blur)="updatePerformance();">
                </mat-form-field>
                <mat-form-field class="card-input">
                  <span matPrefix>$ &nbsp;</span>
                  <input matInput placeholder="Mello-Roos" name="melloRoos" [(ngModel)]="rentalData.melloRoos" (blur)="updatePerformance();" matTooltip="parcel tax (common in CA)">
                </mat-form-field>
              </p>
        </mat-tab>
        <!--   --   assumptions   --       -->
        <mat-tab label="Assumptions"> 
            <p>
              <mat-form-field class="card-input" matTooltip="prinicipal and interest change monthly">
                <input matInput [matDatepicker]="picker" placeholder="Purchase Date" [formControl]="purchaseDate" 
                  (blur)="datePurchased()">
                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker  (closed)="datePurchased();"></mat-datepicker>
              </mat-form-field>
            </p>
            <p>
              <mat-form-field class="card-input" matTooltip="effects tax savings">
                <input matInput placeholder="Income Tax Rate" name="salaryTaxRate" 
                      [ngModel]="rentalData.salaryTaxRate*100 | number:'1.0-0'" (blur)="inputBlur($event);">
              </mat-form-field>%
            </p>
            <p>
              <mat-form-field class="card-input" matTooltip="influences mortgage payment and outflow">
                <input matInput placeholder="Interest Rate" name="interestRate" 
                      [ngModel]="rentalData.interestRate*100 | number:'1.1-4'" (blur)="inputBlur($event);">
              </mat-form-field>%
            </p>
            <p>
              <mat-form-field class="card-input" matTooltip="30yrs = 360 months">
                <input matInput placeholder="Loan Term" name="loanTerm" 
                      [ngModel]="rentalData.loanTerm" (blur)="inputBlur($event);">
              </mat-form-field>mo.
            </p>
            <p>
              <mat-form-field class="card-input" matTooltip="heavily effects performance">
                <input matInput placeholder="Down Payment" name="downPayment" 
                      [ngModel]="rentalData.downPayment*100 | number:'1.0-0'" (blur)="inputBlur($event);">
              </mat-form-field>%
            </p>
            <p>
              <mat-form-field class="card-input" matTooltip="typical CA property tax is about 1.25%">
                <input matInput placeholder="Property Tax Rate" name="propertyTaxRate" 
                      [ngModel]="rentalData.propertyTaxRate*100 | number:'1.3-4'" (blur)="inputBlur($event);">
              </mat-form-field>%
            </p>
            <p>
              <mat-form-field class="card-input" matTooltip="insurance premiums (annualized)">
                <input matInput placeholder="Insurance Rate" name="insuranceRate" 
                      [ngModel]="rentalData.insuranceRate*100 | number:'1.2-3'" (blur)="inputBlur($event);">
              </mat-form-field>%
            </p>
            <p>
              <mat-form-field class="card-input" matTooltip="maintenance costs (annualized)">
                <input matInput placeholder="Maintenance Rate" name="salaryTaxRate" 
                      [ngModel]="rentalData.maintenanceRate*100 | number:'1.2-3'" (blur)="inputBlur($event);">
              </mat-form-field>%
            </p>
            <p>
              <mat-form-field class="card-input" matTooltip="vacancy from turnover">
                <input matInput placeholder="Vacancy Rate" name="vacancyRate" 
                      [ngModel]="rentalData.vacancyRate*100 | number:'1.2-3'" (blur)="inputBlur($event);">
              </mat-form-field>%
            </p>
            <p>
                <mat-form-field class="card-input" matTooltip="usually 10% of rent">
                  <input matInput placeholder="Management Rate" name="managementRate"
                        [ngModel]="rentalData.managementRate*100 | number:'1.2-3'" (blur)="inputBlur($event);">
                </mat-form-field>%
            </p>
        </mat-tab>
        <!--   --   Details   --       -->
        <mat-tab label="Details">
            <h3>Cost (with fees): <span class="detail-text">{{ (cost/1000) | currency:'USD':'symbol':'1.1-1' }}K</span></h3>
            <h5>Down Payment: <span class="detail-text">{{ ((rentalData.downPayment*rentalData.price)/1000) | currency:'USD':'symbol':'1.1-1' }}K</span></h5>
            <h5>Transaction Fees: <span class="detail-text">{{ (rentalData.price*feesPercentage) | currency }}</span></h5>
            <div class="divider"></div>
            <h3>Cash Outflow (monthly): <span class="detail-text">{{monthlyOutflow | currency}}</span></h3>
            <ul>
              <li><h5>Mortgage Payment: <span class="detail-text">{{monthlyPayment | currency}}</span></h5></li>
              <li><h5>Property Tax: <span class="detail-text">{{monthlyPropertyTax | currency}}</span></h5></li>
              <li><h5>HOA: <span class="detail-text">{{rentalData.hoa | currency}}</span></h5></li>
              <li><h5>Mello-Roos: <span class="detail-text">{{rentalData.melloRoos | currency}}</span></h5></li>
              <li><h5>Maintenance: <span class="detail-text">{{monthlyMaintenance | currency}}</span></h5></li>
              <li><h5>Insurance: <span class="detail-text">{{monthlyInsurance | currency}}</span></h5></li>
              <li *ngIf="rentalData.downPayment<0.2"><h5>PMI (Mortgage Insurance): <span class="detail-text">{{monthlyPMI | currency}}</span></h5></li>
              <li *ngIf="rentalData.managementRate>0"><h5>Managment Fee: <span class="detail-text">{{monthlyManagement | currency}}</span></h5></li>
            </ul>
            <div class="divider"></div>
            <h3>Tax Savings (monthly): <span class="detail-text">{{monthlyTaxSavings | currency}}</span></h3>
            <ul>
              <li><h5>Interest Write Off: <span class="detail-text">{{rentalData.salaryTaxRate*monthlyInterest | currency}}</span></h5></li>
              <li><h5>Property Write Off: <span class="detail-text">{{rentalData.salaryTaxRate*monthlyPropertyTax | currency}}</span></h5></li>
              <li><h5>Depreciation Write Off: <span class="detail-text">{{rentalData.salaryTaxRate*monthlyDepreciation | currency}}</span></h5></li>
            </ul>
            <div class="divider"></div>
            <h3>Mortgage Payment: {{monthlyPayment | currency}}</h3>
              <ul>
                <li><h5>Interest (1st Term): <span class="detail-text">{{monthlyInterest | currency}}</span></h5></li>
                <li><h5>Principal (1st Term): <span class="detail-text">{{monthlyPrincipal | currency}}</span></h5></li>
                <li><h5>Loan Term: <span class="detail-text">{{term}} months ({{rentalData.loanTerm - term}} remaining)</span></h5></li>
              </ul>
            <div class="card-actions">
              <button mat-raised-button color="accent" (click)="generateAmmortizationSchedule()">Show Ammortization Schedule</button>
            </div>
            <div class="line-break"></div>
            <div class="divider"></div>
            <h3>Expenses: <span class="detail-text">{{monthlyExpense | currency}}</span></h3>
            <div class="divider"></div>
            <table *ngIf="showAmmortization" mat-table [dataSource]="ammortizationSchedule" class="mat-elevation-z8 ammortization-table">
                <ng-container matColumnDef="term">
                  <th mat-header-cell *matHeaderCellDef> Term </th>
                  <td mat-cell *matCellDef="let element"> {{element.term}} </td>
                </ng-container>
                <ng-container matColumnDef="interest">
                  <th mat-header-cell *matHeaderCellDef> Interest </th>
                  <td mat-cell *matCellDef="let element"> {{element.interest | currency}} </td>
                </ng-container>
                <ng-container matColumnDef="principal">
                  <th mat-header-cell *matHeaderCellDef> Principal </th>
                  <td mat-cell *matCellDef="let element"> {{element.principal | currency}} </td>
                </ng-container>
                <tr mat-header-row *matHeaderRowDef="ammortizationColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: ammortizationColumns;"></tr>
            </table>
        </mat-tab>
      </mat-tab-group>
      <div class="card-actions">
          <button mat-raised-button color="accent" (click)="onDrop()">Remove</button>
          <button mat-raised-button color="primary" (click)="onSave()">Save</button>
      </div>
  </mat-card-content>
</mat-card>
